<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ltd.newbee.mall.dao.TabelogMapper">
<!-- Portal -->
    <!-- 曖昧検索 -->
    <select id="getKeywordList" parameterType="java.lang.String" resultType="ltd.newbee.mall.entity.RestaurantKeyword">
        select keyword
        from restaurant_keyword where keyword like CONCAT('%', #{keyword}, '%')
    </select>
    
    <select id="getCityList" parameterType="java.lang.String" resultType="ltd.newbee.mall.entity.RestaurantJapanRegion">
        select city_name
        from restaurant_japan_region where city_name like CONCAT('%', #{cityName}, '%')
    </select>
    
    <select id="getDistrictList" parameterType="java.lang.String" resultType="ltd.newbee.mall.entity.RestaurantJapanRegion">
        select district_name
        from restaurant_japan_region where district_name like CONCAT('%', #{districtName}, '%')
    </select>
    
    <select id="getStationList" parameterType="java.lang.String" resultType="ltd.newbee.mall.entity.RestaurantJapanStation">
        select concat(station_name, '(', location, ')')
        from restaurant_japan_station where station_name like CONCAT('%', #{stationName}, '%')
    </select>
    
<!-- Detail Page -->
    <!-- Keyword(Header) -->
    <select id="getKeywordByRestaurantId" parameterType="java.lang.Long" resultType="ltd.newbee.mall.entity.RestaurantKeyword">
        select keyword
        from restaurant_keyword where restaurant_id = #{restaurantId,jdbcType=BIGINT}
    </select>
    
    <!-- RestaurantBasicInfo(Header) -->
    <select id="getRestaurantBasicInfo" parameterType="java.lang.Long" resultType="ltd.newbee.mall.entity.RestaurantBasicInfo">
        select restaurant_id, restaurant_name, genre1, genre2, genre3, genre4, tel, reserve_availability, address,
        	   station1, station2, station3, transportation1, transportation2, transportation3, distance,
        	   business_workday_hour, business_weekend_hour, regular_holiday, budget_night, budget_daytime,
        	   pay_method1, pay_method2, service_charge, region, city, district, town, village, pillow_word,
        	   extra_info_title, extra_info_detail, comment_title, comment_detail
        from restaurant_basic_info where restaurant_id = #{restaurantId,jdbcType=BIGINT}
    </select>
    
     <!-- restaurant_reviewの各点数の平均評価 --> 
    <select id="getAverageScoreByRestaurantId" parameterType="java.lang.Long" resultType="java.lang.Double">
    	select avg((score_total + score_taste + score_service + score_atmosphere + score_cost + score_drink) / 6) as average_score, restaurant_id 	
	    from restaurant_review
    	where restaurant_id = #{restaurantId,jdbcType=BIGINT}
    	group by restaurant_id
    </select>
    
    <!-- Count Of Review -->
    <select id="getCountOfReview" parameterType="java.lang.Long" resultType="java.lang.Long">
        select count(*) from restaurant_review
		where restaurant_id = #{restaurantId,jdbcType=BIGINT}
    </select>
    
    <!-- Count Of Followed -->
    <select id="getCountOfFollowed" parameterType="java.lang.Long" resultType="java.lang.Long">
        select count(follow_res_id) from restaurant_user_info
		where restaurant_id = #{restaurantId,jdbcType=BIGINT}
    </select>
    
    <!-- Go To Eat -->
    <select id="getGoToEat" parameterType="java.lang.Long" resultType="java.lang.String">
        select go_to_eat from restaurant_features_info
		where restaurant_id = #{restaurantId,jdbcType=BIGINT}
    </select>
    
    <!-- Top Slide Photo -->
    <select id="getSlidePhoto" parameterType="java.lang.Long" resultType="ltd.newbee.mall.entity.RestaurantPhoto">
        select photo_url from restaurant_photo
		where restaurant_id = #{restaurantId,jdbcType=BIGINT}
    </select>
    
    <!-- Top Kodawari -->
    <select id="getKodawari" parameterType="java.lang.Long" resultType="ltd.newbee.mall.entity.RestaurantPhotoCommitment">
        select restaurant_id, photo_id, photo_url, photo_title, photo_detail, photo_type, type_color
        from restaurant_photo_commitment
		where restaurant_id = #{restaurantId,jdbcType=BIGINT}
    </select>
    
    <!-- Top Course -->
    <select id="getMenuCourse" parameterType="java.lang.Long" resultType="ltd.newbee.mall.entity.RestaurantMenuCourse">
        select restaurant_id, restaurant_name, course_id, course_name, course_detail, course_img, course_price,
        course_price_discount, course_item_num, available_hour, available_time, available_people, drink_all,
        course_content, course_note
        from restaurant_menu_course
		where restaurant_id = #{restaurantId,jdbcType=BIGINT}
    </select>
    
    <!-- Review -->
    <select id="getReview" parameterType="java.lang.Long" resultType="ltd.newbee.mall.entity.RestaurantReview">
        select restaurant_id, restaurant_name, review_id, review_user_id, review_user_name, review_user_age,
        review_user_gender, review_user_city, review_title, review_detail, review_img, score_total, score_taste,
        score_service, score_atmosphere, score_cost, score_drink, budget, visit_date, night_or_daytime, reply_detail
        from restaurant_review
		where restaurant_id = #{restaurantId,jdbcType=BIGINT}
    </select>

</mapper>